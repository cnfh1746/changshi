# 背诵尖塔 - 项目日志

## 2026-01-04

### UI界面全面修复

**问题一：场景重叠**
- style.css 文件丢失导致多个场景同时显示
- 已重新创建完整的 style.css

**问题二：涅奥事件布局**
- 修改为左1/3对话框 + 右2/3 `neow.png` 动漫图片
- 使用 `images/ui/neow.png` 替换鲸鱼emoji

**问题三：战斗界面布局优化**（参考旧版设计）
- 顶部：状态栏（生命、金币、层数）
- 左侧：玩家区域（角色图片、状态）
- 中间：题目区域 + 卡牌区域
- 右侧：敌人区域（敌人图片、意图、血条）

**问题四：题目内容换行格式**
- 数字序号 `1. ` `2. ` → 换行并加粗
- 括号序号 `(1)` `(2)` → 换行并缩进
- 项目符号 `•` → 换行并缩进
- 中文分号 `；` → 后续内容换行

**修改的文件**：
- `style.css`：完整重写，添加场景管理、三栏布局
- `index.html`：涅奥事件结构改为左右布局
- `game.js`：`loadBattleQuestion` 添加内容格式化逻辑

---

## 2026-01-03

### 题库生成与干扰项

完成了填空题题库的完整生成和干扰项设计：

**题库内容**：
- 总章节：37个（习思想15章 + 马原22章）
- 总题目：100道
- 总空位：306个
- 数据来源：`ai提取填空.md` + `ai提炼讲义.md`

**干扰项**：
- 254个答案-干扰项映射
- 每个空位4个干扰项
- 匹配率：100%
- 策略：时间替换、反义词、程度变化、绝对化、相近概念、答案互换

**生成的文件**：
- `distractors_data.py`：干扰项映射表
- `data_with_distractors.js`：带干扰项的完整题库
- 已整合到 `data.js` 中

---

## 2026-01-02

### 图片资源生成

成功生成17张游戏资源图片，分类存放在 `images/` 目录下：

#### 商品图片 (`images/items/`) - 7张
| 文件名 | 说明 |
|--------|------|
| `item_healing_potion_*.png` | 治疗药水 |
| `item_strength_potion_*.png` | 力量药水 |
| `item_magic_tome_*.png` | 魔法书 |
| `item_magic_shield_*.png` | 魔法护盾 |
| `item_gold_pouch_*.png` | 金币袋 |
| `item_armor_plate_*.png` | 护甲 |
| `item_lucky_coin_*.png` | 幸运币 |

#### NPC图片 (`images/npcs/`) - 5张
| 文件名 | 说明 |
|--------|------|
| `npc_merchant_*.png` | 商人 |
| `npc_fortune_teller_*.png` | 占卜师 |
| `npc_blacksmith_*.png` | 铁匠 |
| `npc_traveler_*.png` | 神秘旅者 |
| `npc_healer_*.png` | 治疗师 |

#### 成就图片 (`images/achievements/`) - 3张
| 文件名 | 说明 |
|--------|------|
| `achievement_streak_master_*.png` | 连击大师 |
| `achievement_perfect_clear_*.png` | 完美通关 |
| `achievement_boss_slayer_*.png` | Boss猎人 |

#### 其他 (`images/elements/`, `images/relics/`, `images/curses/`)
| 文件名 | 说明 |
|--------|------|
| `element_treasure_chest_*.png` | 宝箱 |
| `relic_ancient_artifact_*.png` | 远古遗物 |
| `curse_dark_mark_*.png` | 诅咒印记 |

### 修复：游戏初始化错误
- **问题**：`DOMContentLoaded` 事件监听器直接传递 `initGame` 函数，导致 `Event` 对象被误传为 `classKey` 参数
- **修复**：使用箭头函数包装调用 `() => initGame()`
- **文件**：`game.js` 第583行

### 修复：场景显示问题（所有场景同时可见）
- **问题**：CSS 特异性冲突，ID 选择器（`#character-selection`、`#neow-event`）和类选择器（`.battle-scene-new`）中的 `display: flex` 覆盖了 `.scene { display: none }` 的默认规则
- **修复**：移除这些规则中的 `display: flex`，由 `.scene.active` 统一控制显示
- **文件**：`style.css` 第209-214行、545-550行、626-634行

### 题库数据提取与生成

从AI提炼的讲义中自动提取填空题题库：

- **数据来源**：
  - `ai提炼讲义.md` - 完整版讲义（含答案）
  - `ai提取填空.md` - 填空版讲义（用______标记空位）
  
- **生成结果**：`questions_new.js`
  - 37个章节，100道题目
  - 308个空位中166个答案匹配成功（54%）
  - 覆盖：习近平新时代中国特色社会主义思想 + 马克思主义基本原理
  
- **生成脚本**：`generate_questions.py`
  - 逐行对比两个markdown文件
  - 按知识点/章节自动分组
  - `______` 转换为 `{{BLANK}}` 格式
